"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[849],{8849:(H,_,r)=>{r.r(_),r.d(_,{RoleModule:()=>O});var c=r(177),e=r(4438),h=r(3621),p=r(837),d=r(9417),u=r(4550),v=r(4058);const x=["formModal"],R=["noticeSwal"],C=n=>["/apps/roles",n],y=n=>({"ki-up":n});function k(n,a){if(1&n&&(e.qex(0),e.j41(1,"div",26),e.nrm(2,"span",27),e.EFF(3),e.nI1(4,"titlecase"),e.k0s(),e.bVm()),2&n){const t=a.$implicit;e.R7$(3),e.SpI("",e.bMT(4,1,t.name)," ")}}function F(n,a){if(1&n&&(e.j41(0,"div",26),e.nrm(1,"span",27),e.j41(2,"em"),e.EFF(3),e.k0s()()),2&n){const t=e.XpG().$implicit;e.R7$(3),e.SpI(" ",0===t.permissions.length?"No permissions given...":"and "+(t.permissions.length-5)+" more..."," ")}}function S(n,a){if(1&n&&(e.qex(0),e.j41(1,"div",15)(2,"div",16)(3,"div",17)(4,"div",18)(5,"h2"),e.EFF(6),e.nI1(7,"titlecase"),e.k0s()()(),e.j41(8,"div",19)(9,"div",20),e.EFF(10),e.k0s(),e.j41(11,"div",21),e.DNE(12,k,5,3,"ng-container",14)(13,F,4,1,"div",22),e.k0s()(),e.j41(14,"div",23)(15,"a",24),e.EFF(16,"View Role"),e.k0s(),e.j41(17,"button",25),e.EFF(18,"Edit Role"),e.k0s()()()(),e.bVm()),2&n){const t=a.$implicit;e.R7$(6),e.JRh(e.bMT(7,6,t.name)),e.R7$(4),e.SpI("Total users with this role: ",t.users.length,""),e.R7$(2),e.Y8G("ngForOf",t.permissions.slice(0,5)),e.R7$(),e.Y8G("ngIf",t.permissions.length>5||0===t.permissions.length),e.R7$(2),e.Y8G("routerLink",e.eq3(8,C,t.id)),e.R7$(2),e.BMQ("data-id",t.id)}}function j(n,a){if(1&n&&(e.qex(0),e.DNE(1,S,19,10,"ng-container",14),e.bVm()),2&n){const t=a.ngIf;e.R7$(),e.Y8G("ngForOf",t.data)}}function w(n,a){1&n&&(e.j41(0,"div"),e.EFF(1,"Role name is required"),e.k0s())}function I(n,a){1&n&&(e.j41(0,"div"),e.EFF(1,"Role name must be at least 4 characters long"),e.k0s())}function E(n,a){if(1&n&&(e.j41(0,"div",48),e.DNE(1,w,2,0,"div",6)(2,I,2,0,"div",6),e.k0s()),2&n){e.XpG();const t=e.sdS(18);e.R7$(),e.Y8G("ngIf",null==t.errors?null:t.errors.required),e.R7$(),e.Y8G("ngIf",null==t.errors?null:t.errors.minlength)}}function M(n,a){if(1&n){const t=e.RV6();e.j41(0,"form",28,2),e.bIt("ngSubmit",function(o){e.eBV(t);const s=e.sdS(1),l=e.XpG();return e.Njj(l.onSubmit(o,s))}),e.j41(2,"div",29)(3,"h4",30),e.EFF(4,"Role Details"),e.k0s(),e.j41(5,"button",31),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.dismiss("Cross click"))}),e.k0s()(),e.j41(6,"div",32)(7,"div",33)(8,"div",34),e.bIt("click",function(){e.eBV(t);const o=e.sdS(13);return e.Njj(o.toggle())}),e.EFF(9,"User Information "),e.j41(10,"span",35),e.nrm(11,"i",36),e.k0s()(),e.j41(12,"div",37,3),e.mxI("ngbCollapseChange",function(o){e.eBV(t);const s=e.XpG();return e.DH7(s.isCollapsed1,o)||(s.isCollapsed1=o),e.Njj(o)}),e.j41(14,"div",38)(15,"label",39),e.EFF(16,"Role Name"),e.k0s(),e.j41(17,"input",40,4),e.mxI("ngModelChange",function(o){e.eBV(t);const s=e.XpG();return e.DH7(s.roleModel.name,o)||(s.roleModel.name=o),e.Njj(o)}),e.k0s(),e.DNE(19,E,3,2,"div",41),e.k0s()()()(),e.j41(20,"div",42)(21,"button",43),e.bIt("click",function(){const o=e.eBV(t).$implicit;return e.Njj(o.dismiss("cancel"))}),e.EFF(22," Discard "),e.k0s(),e.j41(23,"button",44)(24,"span",45),e.EFF(25," Submit "),e.k0s(),e.j41(26,"span",46),e.EFF(27," Please wait... "),e.nrm(28,"span",47),e.k0s()()()()}if(2&n){const t=e.sdS(1),i=e.XpG();e.R7$(8),e.BMQ("aria-expanded",!i.isCollapsed1),e.R7$(3),e.Y8G("ngClass",e.eq3(6,y,!i.isCollapsed1)),e.R7$(),e.R50("ngbCollapse",i.isCollapsed1),e.R7$(5),e.R50("ngModel",i.roleModel.name),e.R7$(2),e.Y8G("ngIf",t.submitted&&t.invalid),e.R7$(4),e.BMQ("data-kt-indicator",i.isLoading?"on":"off")}}let T=(()=>{class n{apiService;cdr;renderer;modalService;isCollapsed1=!1;isLoading=!1;roles$;reloadEvent=new e.bkB;role$;roleModel={id:0,name:"",permissions:[],users:[]};formModal;noticeSwal;swalOptions={};modalConfig={modalDialogClass:"modal-dialog modal-dialog-centered mw-650px"};clickListener;constructor(t,i,o,s){this.apiService=t,this.cdr=i,this.renderer=o,this.modalService=s}ngAfterViewInit(){this.clickListener=this.renderer.listen(document,"click",t=>{const i=t.target.closest(".btn");if(i){const{action:o,id:s}=i.dataset;switch(o){case"view":case"delete":break;case"create":this.create(),this.modalService.open(this.formModal,this.modalConfig);break;case"edit":this.edit(s),this.modalService.open(this.formModal,this.modalConfig)}}})}ngOnInit(){this.roles$=this.apiService.getRoles()}delete(t){this.apiService.deleteRole(t).subscribe(()=>{})}edit(t){this.role$=this.apiService.getRole(t),this.role$.subscribe(i=>{this.roleModel=i})}create(){this.roleModel={id:0,name:"",permissions:[],users:[]}}onSubmit(t,i){if(i&&i.invalid)return;this.isLoading=!0;const o={icon:"success",title:"Success!",text:this.roleModel.id>0?"User updated successfully!":"User created successfully!"},s={icon:"error",title:"Error!",text:""},l=()=>{this.isLoading=!1,this.modalService.dismissAll(),this.roles$=this.apiService.getRoles(),this.cdr.detectChanges()};this.roleModel.id>0?(()=>{this.apiService.updateRole(this.roleModel.id,this.roleModel).subscribe({next:()=>{this.showAlert(o),this.reloadEvent.emit(!0)},error:f=>{s.text=this.extractText(f.error),this.showAlert(s),this.isLoading=!1},complete:l})})():(()=>{this.apiService.createRole(this.roleModel).subscribe({next:()=>{this.showAlert(o),this.reloadEvent.emit(!0)},error:f=>{s.text=this.extractText(f.error),this.showAlert(s),this.isLoading=!1},complete:l})})()}extractText(t){var i=[];for(var o in t)"string"==typeof t[o]?i.push(t[o]):"object"==typeof t[o]&&(i=i.concat(this.extractText(t[o])));return Array.from(new Set(i)).join("\n")}showAlert(t){let i=t.icon?.toString()||"success";"error"===t.icon&&(i="danger"),this.swalOptions=Object.assign({buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-"+i}},t),this.cdr.detectChanges(),this.noticeSwal.fire()}ngOnDestroy(){this.clickListener&&this.clickListener(),this.modalService.dismissAll()}static \u0275fac=function(i){return new(i||n)(e.rXU(h.W),e.rXU(e.gRc),e.rXU(e.sFG),e.rXU(p.Bq))};static \u0275cmp=e.VBU({type:n,selectors:[["app-role-listing"]],viewQuery:function(i,o){if(1&i&&(e.GBs(x,5),e.GBs(R,5)),2&i){let s;e.mGM(s=e.lsd())&&(o.formModal=s.first),e.mGM(s=e.lsd())&&(o.noticeSwal=s.first)}},decls:14,vars:4,consts:[["noticeSwal",""],["formModal",""],["myForm","ngForm"],["collapse1","ngbCollapse"],["name","ngModel"],[1,"row","row-cols-1","row-cols-md-2","row-cols-xl-3","g-5","g-xl-9"],[4,"ngIf"],[1,"ol-md-4"],[1,"card","h-md-100"],[1,"card-body","d-flex","flex-center"],["type","button","data-action","create",1,"btn","btn-clear","d-flex","flex-column","flex-center"],["src","assets/media/illustrations/sketchy-1/4.png","alt","",1,"mw-100","mh-150px","mb-7"],[1,"fw-bold","fs-3","text-gray-600","text-hover-primary"],[3,"swalOptions"],[4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"card","card-flush","h-md-100"],[1,"card-header"],[1,"card-title"],[1,"card-body","pt-1"],[1,"fw-bold","text-gray-600","mb-5"],[1,"d-flex","flex-column","text-gray-600"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"card-footer","flex-wrap","pt-0"],[1,"btn","btn-light","btn-active-primary","my-1","me-2",3,"routerLink"],["type","button","data-action","edit",1,"btn","btn-light","btn-active-light-primary","my-1"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"],[3,"ngSubmit"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["id","kt_modal_update_customer_scroll","data-kt-scroll","true","data-kt-scroll-activate","{default: false, lg: true}","data-kt-scroll-max-height","auto","data-kt-scroll-dependencies","#kt_modal_update_customer_header","data-kt-scroll-wrappers","#kt_modal_update_customer_scroll","data-kt-scroll-offset","300px",1,"d-flex","flex-column","scroll-y","me-n7","pe-7","mw-650px"],["data-bs-toggle","collapse","role","button","aria-controls","kt_modal_update_customer_user_info",1,"fw-bold","fs-3","rotate","collapsible","mb-7",3,"click"],[1,"ms-2","rotate-180"],[1,"ki-duotone","ki-down","fs-3",3,"ngClass"],[1,"collapse","show",3,"ngbCollapseChange","ngbCollapse"],[1,"fv-row","mb-7"],[1,"required","fw-semibold","fs-6","mb-2"],["type","text","name","name","required","","minlength","4",1,"form-control","form-control-solid",3,"ngModelChange","ngModel"],["class","fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback",4,"ngIf"],[1,"modal-footer","flex-center"],["type","reset","id","kt_modal_update_customer_cancel",1,"btn","btn-light","me-3",3,"click"],["type","submit","id","kt_modal_update_customer_submit",1,"btn","btn-primary"],[1,"indicator-label"],[1,"indicator-progress"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"],[1,"fv-plugins-message-container","fv-plugins-message-container--enabled","invalid-feedback"]],template:function(i,o){1&i&&(e.j41(0,"div",5),e.DNE(1,j,2,1,"ng-container",6),e.nI1(2,"async"),e.j41(3,"div",7)(4,"div",8)(5,"div",9)(6,"button",10),e.nrm(7,"img",11),e.j41(8,"div",12),e.EFF(9,"Add New Role"),e.k0s()()()()()(),e.nrm(10,"swal",13,0),e.DNE(12,M,29,8,"ng-template",null,1,e.C5r)),2&i&&(e.R7$(),e.Y8G("ngIf",e.bMT(2,2,o.roles$)),e.R7$(9),e.Y8G("swalOptions",o.swalOptions))},dependencies:[c.YU,c.Sq,c.bT,d.qT,d.me,d.BC,d.cb,d.YS,d.xh,d.vS,d.cV,u.Wk,p.$G,v.b7,c.Jj,c.PV]})}return n})();var G=r(7586),b=r.n(G),L=r(6100);function D(n,a){if(1&n&&(e.j41(0,"div",19),e.nrm(1,"span",20),e.EFF(2),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" ",t.name," ")}}function N(n,a){if(1&n&&(e.j41(0,"div",19),e.nrm(1,"span",20),e.j41(2,"em"),e.EFF(3),e.k0s()()),2&n){const t=e.XpG(2).ngIf;e.R7$(3),e.SpI("and ",t.permissions.length-5," more...")}}function Y(n,a){if(1&n&&(e.qex(0),e.DNE(1,D,3,1,"div",18)(2,N,4,1,"div",18),e.bVm()),2&n){const t=a.index,i=e.XpG().ngIf;e.R7$(),e.Y8G("ngIf",t<5),e.R7$(),e.Y8G("ngIf",5===t&&(null==i.permissions?null:i.permissions.length)&&i.permissions.length>5)}}function B(n,a){if(1&n&&(e.qex(0),e.DNE(1,Y,3,2,"ng-container",17),e.bVm()),2&n){const t=a.ngIf;e.R7$(),e.Y8G("ngForOf",t.permissions)}}function V(n,a){if(1&n&&(e.qex(0),e.j41(1,"span",21),e.EFF(2),e.k0s(),e.bVm()),2&n){const t=a.ngIf;e.R7$(2),e.SpI("(",t.users.length,")")}}let U=(()=>{class n{route;apiService;role$;datatableConfig={};reloadEvent=new e.bkB;constructor(t,i){this.route=t,this.apiService=i}ngOnInit(){this.route.params.subscribe(t=>{const i=t.id;this.role$=this.apiService.getRole(i),this.datatableConfig={serverSide:!0,ajax:(o,s)=>{this.apiService.getUsers(i,o).subscribe(l=>{console.log(l),s(l)})},columns:[{title:"Name",data:"name",render:function(o,s,l){const m=["success","info","warning","danger"],g=m[Math.floor(Math.random()*m.length)],f=o[0].toUpperCase();return`\n              <div class="symbol symbol-circle symbol-50px overflow-hidden me-3" data-action="view" data-id="${l.id}">\n                <a href="javascript:;">\n                  \n              <div class="symbol-label fs-3 bg-light-${g} text-${g}">\n                ${f}\n              </div>\n            \n                </a>\n              </div>\n              \n              <div class="d-flex flex-column" data-action="view" data-id="${l.id}">\n                <a href="javascript:;" class="text-gray-800 text-hover-primary mb-1">${o}</a>\n                <span>${l.email}</span>\n              </div>\n            \n            `}},{title:"Role",data:"role",render:function(o,s,l){return l.roles[0]?.name||""},orderData:[1],orderSequence:["asc","desc"],type:"string"},{title:"Last Login",data:"last_login_at",render:(o,s,l)=>{const m=o||l.created_at;return`<div class="badge badge-light fw-bold">${b()(m).fromNow()}</div>`}},{title:"Joined Date",data:"created_at",render:function(o){return b()(o).format("DD MMM YYYY, hh:mm a")}}],createdRow:function(o,s,l){$("td:eq(0)",o).addClass("d-flex align-items-center")}}})}deleteUser(t){this.route.params.subscribe(i=>{this.apiService.deleteUser(i.id,t).subscribe(()=>{this.reloadEvent.emit(!0)})})}static \u0275fac=function(i){return new(i||n)(e.rXU(u.nX),e.rXU(h.W))};static \u0275cmp=e.VBU({type:n,selectors:[["app-role-details"]],decls:26,vars:11,consts:[[1,"d-flex","flex-column","flex-lg-row"],[1,"flex-column","flex-lg-row-auto","w-100","w-lg-200px","w-xl-300px","mb-10"],[1,"card","card-flush"],[1,"card-header"],[1,"card-title"],[1,"mb-0"],[1,"card-body","pt-0"],[1,"d-flex","flex-column","text-gray-600"],[4,"ngIf"],[1,"card-footer","pt-0"],["type","button","data-role-id","developer","data-bs-toggle","modal","data-bs-target","#kt_modal_update_role",1,"btn","btn-light","btn-active-primary"],[1,"flex-lg-row-fluid","ms-lg-10"],[1,"card","card-flush","mb-6","mb-xl-9"],[1,"card-header","pt-5"],[1,"d-flex","align-items-center"],[1,"card-toolbar"],[3,"deleteEvent","datatableConfig","reload"],[4,"ngFor","ngForOf"],["class","d-flex align-items-center py-2",4,"ngIf"],[1,"d-flex","align-items-center","py-2"],[1,"bullet","bg-primary","me-3"],[1,"text-gray-600","fs-6","ms-1"]],template:function(i,o){if(1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e.EFF(6),e.nI1(7,"async"),e.k0s()()(),e.j41(8,"div",6)(9,"div",7),e.DNE(10,B,2,1,"ng-container",8),e.nI1(11,"async"),e.k0s()(),e.j41(12,"div",9)(13,"button",10),e.EFF(14,"Edit Role"),e.k0s()()()(),e.j41(15,"div",11)(16,"div",12)(17,"div",13)(18,"div",4)(19,"h2",14),e.EFF(20,"Users Assigned "),e.DNE(21,V,3,1,"ng-container",8),e.nI1(22,"async"),e.k0s()(),e.nrm(23,"div",15),e.k0s(),e.j41(24,"div",6)(25,"app-crud",16),e.bIt("deleteEvent",function(l){return o.deleteUser(l)}),e.k0s()()()()()),2&i){let s;e.R7$(6),e.SpI(" ",null==(s=e.bMT(7,5,o.role$))?null:s.name," "),e.R7$(4),e.Y8G("ngIf",e.bMT(11,7,o.role$)),e.R7$(11),e.Y8G("ngIf",e.bMT(22,9,o.role$)),e.R7$(4),e.Y8G("datatableConfig",o.datatableConfig)("reload",o.reloadEvent)}},dependencies:[c.Sq,c.bT,L.i,c.Jj]})}return n})();var X=r(7470),A=r(691);let O=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.$C({type:n});static \u0275inj=e.G2t({imports:[c.MD,d.YN,d.X1,u.iI.forChild([{path:"",component:T},{path:":id",component:U}]),A.B,X.G,p.Pv,p.zH,p.HC,p.n8,v.RZ.forChild()]})}return n})()}}]);